# Order History Setup Instructions

## Database Setup

To enable the order history feature, you need to create the `order_history` table in your Supabase database.

### Steps:

1. **Open Supabase Dashboard**

   - Go to your Supabase project dashboard
   - Navigate to the SQL Editor (found in the left sidebar)

2. **Run the Migration SQL**

   - Open the file `supabase_order_history_migration.sql` in this project
   - Copy all the SQL content
   - Paste it into the Supabase SQL Editor
   - Click "Run" to execute the SQL

3. **Verify Table Creation**
   - Go to the "Table Editor" in Supabase
   - You should see a new table called `order_history`
   - The table should have the following columns:
     - `order_id` (Primary Key, auto-generated)
     - `username`
     - `product_id`
     - `quantity`
     - `unit_price`
     - `total_price`
     - `delivery_charge`
     - `delivery_address`
     - `phone`
     - `city`
     - `postal_code`
     - `customer_name`
     - `payment_method`
     - `status`
     - `created_at`
     - `updated_at`

## Features Implemented

### 1. **Checkout Flow**

- Cart page now has a "Proceed to Checkout" button
- Checkout page shows:
  - Payment method: Cash on Delivery (COD) with +100 BDT delivery charge
  - Delivery address form (name, phone, address, city, postal code)
  - Order summary with subtotal, delivery charge, and total
  - "Place Order" button

### 2. **Order Placement**

- When user clicks "Place Order":
  - All cart items are saved to the `order_history` table
  - Each product in cart creates a separate order record
  - Cart is cleared after successful order
  - Success toast message is shown
  - User is redirected to home page

### 3. **Order History**

- Profile page now has an "Order History" option
- Clicking it shows all past orders
- Each order displays:
  - Order ID and status (PENDING, etc.)
  - Date and time of order
  - Product image (fetched from products table)
  - Product title
  - Quantity, unit price, and total price
- Orders are sorted by most recent first

### 4. **Design**

- Clean, minimal, professional UI
- Consistent color scheme (Color(0xFF134686))
- Proper form validation
- Loading states and error handling
- Rounded corners and proper spacing

## Usage

1. **Add items to cart** from product details page
2. **Go to Cart** and review items
3. **Click "Proceed to Checkout"**
4. **Fill in delivery information**
5. **Review order summary** (includes +100 BDT COD charge)
6. **Click "Place Order"**
7. **View order history** from Profile page

## Security

- Row Level Security (RLS) is enabled on the `order_history` table
- Users can only view and insert their own orders
- Orders are linked to users via username/email

## Notes

- All prices are stored as TEXT in the database (as per your existing schema)
- Currency is shown as "BDT" throughout
- Order ID is auto-generated by the database
- Order status defaults to "pending"
